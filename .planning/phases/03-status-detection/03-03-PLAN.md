---
phase: 03-status-detection
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/SessionRow.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "User sees status emoji for each session (checkmark/hourglass/stop sign)"
    - "User sees model type (sonnet/opus/haiku) for each session"
    - "Blocked sessions visually stand out with bold text and red background"
    - "Status accurately reflects actual Claude state (human verified)"
  artifacts:
    - path: "src/components/SessionRow.tsx"
      provides: "Status emoji, model display, blocked highlighting"
      min_lines: 50
  key_links:
    - from: "src/components/SessionRow.tsx"
      to: "Session.status"
      via: "STATUS_EMOJI mapping and conditional styling"
      pattern: "STATUS_EMOJI\\[session\\.status\\]"
    - from: "src/components/SessionRow.tsx"
      to: "Session.model"
      via: "model display at end of row"
      pattern: "session\\.model"
    - from: "src/services/statusDetector.ts"
      to: "src/services/sessionBuilder.ts"
      via: "getSessionStatus returns enriched data"
      pattern: "getSessionStatus"
    - from: "src/services/sessionBuilder.ts"
      to: "store.sessions"
      via: "buildSessions populates store"
      pattern: "buildSessions"
---

<objective>
Update SessionRow UI to display status indicators, model type, and blocked session highlighting.

Purpose: Make session status instantly visible through emojis and visual emphasis, fulfilling "never miss a blocked Claude" core value.
Output: Updated SessionRow.tsx with status emoji, model display, and blocked row highlighting.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-status-detection/03-CONTEXT.md
@.planning/phases/03-status-detection/03-02-SUMMARY.md

@src/stores/types.ts
@src/components/SessionRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SessionRow with Status Indicator and Model</name>
  <files>src/components/SessionRow.tsx</files>
  <action>
Update SessionRow.tsx to display status emoji, model, and blocked highlighting.

**Data Flow Verification (confirm before implementing):**
Trace the data pipeline to ensure session.status and session.model have real values:
1. statusDetector.getSessionStatus(projectPath) -> reads JSONL, returns { status, model }
2. sessionBuilder.buildSessions() -> calls getSessionStatus for each session, populates Session objects
3. store.sessions -> receives enriched Session[] from buildSessions
4. SessionRow props -> receives session from store via parent component

If any link is broken (e.g., buildSessions not calling getSessionStatus), fix in Plan 03-02 first.

**Implementation Changes:**

1. Add STATUS_EMOJI constant at top of file (after imports):
   ```typescript
   const STATUS_EMOJI: Record<Session['status'], string> = {
     idle: '\u2705',      // Green checkmark
     working: '\u23F3',   // Hourglass
     blocked: '\u{1F6D1}', // Stop sign (Unicode escape for emoji)
     ended: '\u274C',     // X mark (for completeness)
   };
   ```

2. Update row layout to new structure per CONTEXT.md:
   Layout: `[index] [status] [project] [duration] [model]`

3. For blocked rows, apply visual emphasis:
   - Use Ink's backgroundColor="red" on the Text wrapper
   - Use bold={true} for the entire row
   - Use color="white" for text contrast against red background
   - **Fallback strategy:** If backgroundColor doesn't extend properly across the full row width, try wrapping in Box with flexGrow={1} or use inverse prop on Text instead. Verify blocked row is clearly visually distinct from non-blocked rows.

4. Implement blocked detection:
   ```typescript
   const isBlocked = session.status === 'blocked';
   ```

5. Model display with null handling:
   - session.model comes from getSessionStatus which returns null for unknown models
   - sessionBuilder defaults null to 'sonnet', so session.model is always 'sonnet' | 'opus' | 'haiku'
   - Display model name at end of row
   - If for some reason model is falsy, show "unknown" in dimColor as defensive fallback:
     ```typescript
     const modelDisplay = session.model || 'unknown';
     ```

6. Adjust column widths:
   - Index: [N] (variable, 3-4 chars)
   - Status emoji: fixed 2 chars (emoji + space)
   - Project name: 24 chars (existing)
   - Duration: 12 chars (existing)
   - Model: right side (sonnet/opus/haiku/unknown)

7. For non-blocked rows:
   - Normal text color (no backgroundColor)
   - Keep existing dimColor for duration
   - Keep cyan color for index

8. Update the JSX structure:
   ```tsx
   <Box flexDirection="row">
     {isBlocked ? (
       <Text bold backgroundColor="red" color="white">
         [{index}] {STATUS_EMOJI[session.status]} {paddedName} {paddedDuration} {modelDisplay}
       </Text>
     ) : (
       <>
         <Text color="cyan" bold>[{index}]</Text>
         <Text> {STATUS_EMOJI[session.status]} </Text>
         <Text>{paddedName}</Text>
         <Text> </Text>
         <Text dimColor>{paddedDuration}</Text>
         <Text> </Text>
         <Text dimColor>{modelDisplay}</Text>
       </>
     )}
   </Box>
   ```

**Note:** The exact JSX structure may need adjustment based on Ink's Text component behavior with backgroundColor. If backgroundColor doesn't render correctly:
- Try wrapping content in Box with inverse prop
- Or use separate Text components with consistent backgroundColor
- Test and iterate until blocked row is clearly visually distinct
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. Run HUD: `npm run dev` and visually inspect
3. Status emoji displays correctly for sessions
4. Model displays at end of each row
5. Trace data flow: statusDetector.getSessionStatus -> sessionBuilder.buildSessions -> store.sessions -> SessionRow props. Verify enriched sessions reach the component.
  </verify>
  <done>SessionRow displays status emoji, model, and blocked rows have red background with bold white text</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Status detection integrated into session display:
- Status emoji (checkmark/hourglass/stop sign) for each session
- Model type (sonnet/opus/haiku) displayed
- Blocked sessions highlighted with red background and bold text
- Blocked sessions sorted to top of list
  </what-built>
  <how-to-verify>
1. Start the HUD: `npm run dev`
2. Have at least one Claude Code session running
3. Verify status displays:
   - Idle session should show green checkmark
   - Working session (if you can trigger one) should show hourglass
   - If you have a blocked session (tool approval waiting), verify:
     - Red/stop sign emoji displays
     - Row has red background with white text
     - Session appears at top of list
4. Verify model displays (sonnet/opus/haiku) at end of each row
5. Compare HUD status to actual Claude session state - does it match?
  </how-to-verify>
  <resume-signal>Type "approved" if status detection works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Status emoji displays for each session status
3. Model type displays at end of row
4. Blocked sessions have visual emphasis (red background, bold)
5. Human verified: HUD status matches actual Claude session state
</verification>

<success_criteria>
- STAT-01: Working state shows hourglass emoji
- STAT-02: Idle state shows checkmark emoji
- STAT-03: Blocked state shows stop sign emoji
- STAT-04: Status conveyed via semantic emojis (green checkmark=idle, amber hourglass=working, red stop=blocked) plus red background for blocked - satisfies RAG indication per CONTEXT.md decision
- STAT-05: Blocked sessions bold with red background
- STAT-06: Model indicator (sonnet/opus/haiku) displays for each session
- Human confirms status matches real Claude state
</success_criteria>

<output>
After completion, create `.planning/phases/03-status-detection/03-03-SUMMARY.md`
</output>
