---
phase: 03-status-detection
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/SessionRow.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "User sees status emoji for each session (checkmark/hourglass/stop sign)"
    - "User sees model type (sonnet/opus/haiku) for each session"
    - "Blocked sessions visually stand out with bold text and red background"
    - "Status accurately reflects actual Claude state (human verified)"
  artifacts:
    - path: "src/components/SessionRow.tsx"
      provides: "Status emoji, model display, blocked highlighting"
      min_lines: 50
  key_links:
    - from: "src/components/SessionRow.tsx"
      to: "Session.status"
      via: "STATUS_EMOJI mapping and conditional styling"
      pattern: "STATUS_EMOJI\\[session\\.status\\]"
    - from: "src/components/SessionRow.tsx"
      to: "Session.model"
      via: "model display at end of row"
      pattern: "session\\.model"
---

<objective>
Update SessionRow UI to display status indicators, model type, and blocked session highlighting.

Purpose: Make session status instantly visible through emojis and visual emphasis, fulfilling "never miss a blocked Claude" core value.
Output: Updated SessionRow.tsx with status emoji, model display, and blocked row highlighting.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-status-detection/03-CONTEXT.md
@.planning/phases/03-status-detection/03-02-SUMMARY.md

@src/stores/types.ts
@src/components/SessionRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SessionRow with Status Indicator and Model</name>
  <files>src/components/SessionRow.tsx</files>
  <action>
Update SessionRow.tsx to display status emoji, model, and blocked highlighting.

Changes:

1. Add STATUS_EMOJI constant at top of file (after imports):
   ```typescript
   const STATUS_EMOJI: Record<Session['status'], string> = {
     idle: '\u2705',      // Green checkmark
     working: '\u23F3',   // Hourglass
     blocked: '\u{1F6D1}', // Stop sign (Unicode escape for emoji)
     ended: '\u274C',     // X mark (for completeness)
   };
   ```

2. Update row layout to new structure per CONTEXT.md:
   Layout: `[index] [status] [project] [duration] [model]`

3. For blocked rows, apply visual emphasis:
   - Use Ink's backgroundColor="red" on the Text wrapper
   - Use bold={true} for the entire row
   - Use color="white" for text contrast against red background

4. Implement blocked detection:
   ```typescript
   const isBlocked = session.status === 'blocked';
   ```

5. Model display:
   - Show model name at end of row (sonnet, opus, haiku)
   - If model is null/undefined, show "unknown" in dimColor

6. Adjust column widths:
   - Index: [N] (variable, 3-4 chars)
   - Status emoji: fixed 2 chars (emoji + space)
   - Project name: 24 chars (existing)
   - Duration: 12 chars (existing)
   - Model: right side (sonnet/opus/haiku/unknown)

7. For non-blocked rows:
   - Normal text color (no backgroundColor)
   - Keep existing dimColor for duration
   - Keep cyan color for index

8. Update the JSX structure:
   ```tsx
   <Box flexDirection="row">
     {isBlocked ? (
       <Text bold backgroundColor="red" color="white">
         [{index}] {STATUS_EMOJI[session.status]} {paddedName} {paddedDuration} {modelDisplay}
       </Text>
     ) : (
       <>
         <Text color="cyan" bold>[{index}]</Text>
         <Text> {STATUS_EMOJI[session.status]} </Text>
         <Text>{paddedName}</Text>
         <Text> </Text>
         <Text dimColor>{paddedDuration}</Text>
         <Text> </Text>
         <Text dimColor>{modelDisplay}</Text>
       </>
     )}
   </Box>
   ```

Note: The exact JSX structure may need adjustment based on Ink's Text component behavior with backgroundColor. Test and iterate if needed.
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. Run HUD: `npm run dev` and visually inspect
3. Status emoji displays correctly for sessions
4. Model displays at end of each row
  </verify>
  <done>SessionRow displays status emoji, model, and blocked rows have red background with bold white text</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Status detection integrated into session display:
- Status emoji (checkmark/hourglass/stop sign) for each session
- Model type (sonnet/opus/haiku) displayed
- Blocked sessions highlighted with red background and bold text
- Blocked sessions sorted to top of list
  </what-built>
  <how-to-verify>
1. Start the HUD: `npm run dev`
2. Have at least one Claude Code session running
3. Verify status displays:
   - Idle session should show green checkmark
   - Working session (if you can trigger one) should show hourglass
   - If you have a blocked session (tool approval waiting), verify:
     - Red/stop sign emoji displays
     - Row has red background with white text
     - Session appears at top of list
4. Verify model displays (sonnet/opus/haiku) at end of each row
5. Compare HUD status to actual Claude session state - does it match?
  </how-to-verify>
  <resume-signal>Type "approved" if status detection works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Status emoji displays for each session status
3. Model type displays at end of row
4. Blocked sessions have visual emphasis (red background, bold)
5. Human verified: HUD status matches actual Claude session state
</verification>

<success_criteria>
- STAT-01: Working state shows hourglass emoji
- STAT-02: Idle state shows checkmark emoji
- STAT-03: Blocked state shows stop sign emoji
- STAT-04: RAG colors via emoji choice (green check, amber hourglass, red stop)
- STAT-05: Blocked sessions bold with red background
- STAT-06: Model indicator (sonnet/opus/haiku) displays for each session
- Human confirms status matches real Claude state
</success_criteria>

<output>
After completion, create `.planning/phases/03-status-detection/03-03-SUMMARY.md`
</output>
