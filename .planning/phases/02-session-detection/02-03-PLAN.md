---
phase: 02-session-detection
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/components/SessionRow.tsx
  - src/components/SessionList.tsx
  - src/app.tsx
autonomous: false

must_haves:
  truths:
    - "Each session displays with index, project name, duration, and tmux indicator"
    - "Index numbers are visually distinct (bold/highlighted) to suggest hotkeys"
    - "Project names truncate with ellipsis if too long"
    - "Duration updates on each refresh cycle"
    - "tmux sessions show visual indicator distinguishing from non-tmux"
    - "HUD shows detected Claude sessions when running"
  artifacts:
    - path: "src/components/SessionRow.tsx"
      provides: "Single session row component"
      exports: ["SessionRow"]
    - path: "src/components/SessionList.tsx"
      provides: "Session list rendering sessions or empty state"
      exports: ["SessionList"]
    - path: "src/app.tsx"
      provides: "Main app with useSessions hook integrated"
      contains: "useSessions"
  key_links:
    - from: "src/components/SessionRow.tsx"
      to: "src/utils/duration.ts"
      via: "imports formatDuration"
      pattern: "import.*formatDuration.*from.*duration"
    - from: "src/components/SessionList.tsx"
      to: "src/components/SessionRow.tsx"
      via: "renders SessionRow for each session"
      pattern: "import.*SessionRow.*from.*SessionRow"
    - from: "src/app.tsx"
      to: "src/hooks/useSessions.ts"
      via: "calls useSessions hook"
      pattern: "useSessions\\(\\)"
---

<objective>
Create session list UI components and integrate session detection with the HUD for human verification.

Purpose: Display detected Claude sessions in the HUD with proper formatting, enabling visual confirmation that session detection works correctly.

Output: SessionRow component, updated SessionList, integrated useSessions hook, and human-verified working detection.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-session-detection/02-CONTEXT.md
@src/components/SessionList.tsx
@src/components/EmptyState.tsx
@src/app.tsx
@src/stores/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: SessionRow Component</name>
  <files>src/components/SessionRow.tsx</files>
  <action>
Create SessionRow component for displaying a single session:

Props:
```typescript
interface SessionRowProps {
  session: Session;
  index: number;  // 1-based display index
}
```

Layout (using Ink Box and Text):
```
[1] cc-tui-hud            45 min     [T]
```

Column breakdown:
- Index: Bold/cyan, 3 chars wide, right-aligned, format `[${index}]`
- Project name: 20-25 chars, truncate with ellipsis if longer
- Duration: Right-aligned, fixed width (~12 chars), dimmed color
- tmux indicator: Show "[T]" in dim/cyan if inTmux, empty otherwise

Implementation:
1. Import Box, Text from 'ink'
2. Import Session from stores/types.js
3. Import formatDuration from utils/duration.js
4. Use flexDirection="row" with gaps or padding between columns
5. Truncate project name: if > 24 chars, slice to 23 + "..."
6. Use Text color="cyan" bold for index to suggest hotkey
7. Use Text dimColor for duration
8. Conditional render tmux indicator based on session.inTmux

Export SessionRow as named export.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>SessionRow component renders index, project name, duration, and tmux indicator</done>
</task>

<task type="auto">
  <name>Task 2: Update SessionList and App Integration</name>
  <files>src/components/SessionList.tsx, src/app.tsx</files>
  <action>
**Update src/components/SessionList.tsx:**

1. Import SessionRow from ./SessionRow.js
2. Keep existing EmptyState import and empty sessions check
3. When sessions exist, render each with SessionRow:
```tsx
return (
  <Box flexDirection="column">
    {sessions.map((session, idx) => (
      <SessionRow key={session.id} session={session} index={idx + 1} />
    ))}
  </Box>
);
```

**Update src/app.tsx:**

1. Import useSessions from ./hooks/useSessions.js
2. Call useSessions() at the top of the App component (after other hooks)
3. This integrates session polling with the existing UI

The useSessions hook handles:
- Initial session detection on mount
- Polling via useInterval
- Updating store which triggers SessionList re-render
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit` and `npm run dev` shows HUD</verify>
  <done>SessionList renders SessionRow for each session; App calls useSessions for polling</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Session detection system that finds running Claude Code instances and displays them in the HUD with project names, duration, and tmux indicators.
  </what-built>
  <how-to-verify>
1. Start the HUD: `npm run dev`

2. **No sessions test:**
   - If no Claude instances running, verify EmptyState displays
   - Header should show "No sessions"

3. **Detection test:**
   - Open another terminal and start a Claude instance: `claude` (or use existing Claude sessions)
   - Within 2 seconds (refresh interval), session should appear in HUD
   - Verify session shows:
     - Index number in cyan/bold (e.g., [1])
     - Project folder name (not full path)
     - Duration (e.g., "< 1 min", "2 min", etc.)
     - [T] indicator if running in tmux, nothing if not

4. **Multiple sessions test:**
   - If you have multiple Claude instances, verify all appear
   - Verify oldest sessions are at top (oldest-first sorting)
   - Verify each has unique index number

5. **Duration update test:**
   - Watch duration update as time passes (every 2 seconds)
   - Duration should increment appropriately

6. **tmux correlation test (if using tmux):**
   - Sessions in tmux should show [T] indicator
   - Sessions in standalone terminals should NOT show [T]

7. **Header count test:**
   - Header should show session count (e.g., "1 session" or "3 sessions")
   - Note: Full status breakdown (blocked/working/idle) comes in Phase 3

8. Exit with 'q' or Ctrl+C (verify clean exit)
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 2, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks (including human verification):
1. `npx tsc --noEmit` passes with no errors
2. `npm run dev` launches HUD without errors
3. Claude sessions detected and displayed within refresh interval
4. Session rows show all required information
5. Human confirmed detection works correctly
</verification>

<success_criteria>
- SessionRow displays index, project, duration, tmux indicator
- SessionList renders rows when sessions exist, EmptyState when empty
- useSessions integrated in App component
- Live detection works (human verified)
- Clean exit behavior maintained
</success_criteria>

<output>
After completion, create `.planning/phases/02-session-detection/02-03-SUMMARY.md`
</output>
