---
phase: 05-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app.tsx
  - src/components/SessionRow.tsx
  - src/components/SessionList.tsx
autonomous: true

must_haves:
  truths:
    - "User can move selection down with j or down arrow"
    - "User can move selection up with k or up arrow"
    - "User can quick-jump to sessions 1-9 using number hotkeys"
    - "Selected session is visually distinct from non-selected sessions"
    - "Selection stays within bounds (0 to sessions.length-1)"
  artifacts:
    - path: "src/app.tsx"
      provides: "Navigation key handlers in useInput"
      contains: "key.downArrow"
    - path: "src/components/SessionRow.tsx"
      provides: "Visual selection indicator"
      contains: "isSelected"
    - path: "src/components/SessionList.tsx"
      provides: "Selection index pass-through"
      contains: "isSelected={idx === selectedIndex}"
  key_links:
    - from: "src/app.tsx"
      to: "appStore.setSelectedIndex"
      via: "useInput handler"
      pattern: "setSelectedIndex.*Math\\.(min|max)"
    - from: "src/components/SessionList.tsx"
      to: "src/components/SessionRow.tsx"
      via: "isSelected prop"
      pattern: "isSelected=\\{idx === selectedIndex\\}"
---

<objective>
Implement keyboard navigation (j/k/arrows, number hotkeys) and visual selection highlighting for the session list.

Purpose: Enable users to navigate sessions by keyboard without mouse, completing NAV-01 and NAV-05 requirements.
Output: Working j/k/arrow navigation, 1-9 number hotkeys, and clear visual indicator for selected session.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-navigation/05-RESEARCH.md

# Key existing files
@src/app.tsx
@src/stores/appStore.ts
@src/components/SessionRow.tsx
@src/components/SessionList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add navigation key handlers to app.tsx</name>
  <files>src/app.tsx</files>
  <action>
Extend the existing useInput callback in app.tsx to handle navigation keys:

1. After the existing overlay state checks (isConfirmingExit, showHelp), add navigation handlers:

2. Add j/k and arrow key navigation:
   - `j` or `key.downArrow`: Move selection down (clamp to sessions.length - 1)
   - `k` or `key.upArrow`: Move selection up (clamp to 0)
   - Use `useAppStore.getState()` to get current sessions and selectedIndex
   - Use `Math.min`/`Math.max` for bounds clamping

3. Add number hotkey support (1-9):
   - Regex test: `/^[1-9]$/.test(input)`
   - Convert to 0-indexed: `parseInt(input, 10) - 1`
   - Only set if targetIndex < sessions.length

4. Early return if sessions.length === 0 (no navigation when empty)

5. Add `sessions` to the selective Zustand subscriptions at the top of the component (needed for navigation logic)

Pattern from research:
```typescript
// After overlay checks, before q/? handlers:
const sessions = useAppStore((state) => state.sessions);
const selectedIndex = useAppStore((state) => state.selectedIndex);

// In useInput:
if (sessions.length === 0) return;

if (input === 'j' || key.downArrow) {
  useAppStore.getState().setSelectedIndex(
    Math.min(selectedIndex + 1, sessions.length - 1)
  );
  return;
}
if (input === 'k' || key.upArrow) {
  useAppStore.getState().setSelectedIndex(
    Math.max(selectedIndex - 1, 0)
  );
  return;
}
if (/^[1-9]$/.test(input)) {
  const targetIndex = parseInt(input, 10) - 1;
  if (targetIndex < sessions.length) {
    useAppStore.getState().setSelectedIndex(targetIndex);
  }
  return;
}
```
  </action>
  <verify>
TypeScript compiles: `npm run build`
Run HUD manually: `npm run dev`
- Press j/k to verify selection moves up/down
- Press arrow keys to verify same behavior
- Press 1-9 to verify quick-jump to session by number
  </verify>
  <done>
j/k and arrow keys move selection up/down within valid bounds.
Number keys 1-9 jump to corresponding session (if exists).
No navigation when session list is empty.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add selection highlighting to SessionRow</name>
  <files>src/components/SessionRow.tsx, src/components/SessionList.tsx</files>
  <action>
1. **Update SessionRow.tsx:**

Add `isSelected` prop to interface:
```typescript
interface SessionRowProps {
  session: Session;
  index: number;
  isSelected: boolean;  // NEW
}
```

Update function signature:
```typescript
export function SessionRow({ session, index, isSelected }: SessionRowProps)
```

Add selection highlighting logic:
- If `isSelected` is true AND session is NOT blocked: use `inverse` prop on the entire row for high-contrast visibility
- If `isSelected` is true AND session IS blocked: use `inverse` on blocked row (swap the red background to inverse)
- The `inverse` prop swaps foreground/background colors, ensuring visibility across all terminal themes

Implementation approach:
- For blocked rows: when isSelected, use `inverse` instead of `backgroundColor="red"`
- For normal rows: when isSelected, wrap content with `inverse` styling
- Keep ContextMeter and [T] indicator outside inverse (they have their own colors)

Example for selected normal row:
```typescript
if (isSelected && !isBlocked) {
  return (
    <Box flexDirection="row">
      <Text inverse bold>
        [{index}] {statusEmoji} {paddedName}
      </Text>
      <Text inverse>{paddedDuration} {modelDisplay}</Text>
      {/* subagent, context meter, tmux indicator remain normal */}
      ...
    </Box>
  );
}
```

For selected blocked row, modify the blocked branch to use inverse when selected:
```typescript
if (isBlocked) {
  return (
    <Box flexDirection="row">
      <Text bold inverse={isSelected} backgroundColor={isSelected ? undefined : "red"} color={isSelected ? undefined : "white"}>
        [{index}] {statusEmoji} {paddedName} {paddedDuration} {modelDisplay}
      </Text>
      ...
    </Box>
  );
}
```

2. **Update SessionList.tsx:**

Add selectedIndex subscription:
```typescript
const selectedIndex = useAppStore((state) => state.selectedIndex);
```

Pass isSelected prop to SessionRow:
```typescript
<SessionRow
  key={session.id}
  session={session}
  index={idx + 1}
  isSelected={idx === selectedIndex}
/>
```
  </action>
  <verify>
TypeScript compiles: `npm run build`
Run HUD manually: `npm run dev`
- Selected row should have inverted colors (high contrast)
- Non-selected rows should render normally
- Blocked selected row should show inverse instead of red background
- Moving selection with j/k should update visual highlight immediately
  </verify>
  <done>
SessionRow accepts isSelected prop and displays inverse colors when selected.
SessionList passes selectedIndex comparison as isSelected prop.
Selection is visually distinct and works with both normal and blocked rows.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes with no TypeScript errors
2. `npm run dev` launches HUD successfully
3. j/k keys move selection up and down
4. Arrow keys (up/down) move selection up and down
5. Number keys 1-9 jump to corresponding session
6. Selected row has inverted colors (clearly visible)
7. Selection wraps at bounds (doesn't go negative or beyond list length)
8. Navigation is disabled when help overlay is shown
9. Navigation is disabled when exit confirmation is shown
</verification>

<success_criteria>
- NAV-01 satisfied: User can move selection up/down with j/k or arrow keys
- NAV-05 satisfied: User can quick-jump to sessions 1-9 using number hotkeys
- Selection is visually indicated with inverse colors
- TypeScript compiles, no runtime errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation/05-01-SUMMARY.md`
</output>
