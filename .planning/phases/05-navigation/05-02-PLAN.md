---
phase: 05-navigation
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/services/jumpService.ts
  - src/app.tsx
autonomous: false

must_haves:
  truths:
    - "User can press Enter to jump to selected tmux session"
    - "HUD remains running after jumping (inside tmux)"
    - "Non-tmux sessions show helpful error message"
    - "Session that no longer exists shows graceful error"
  artifacts:
    - path: "src/services/jumpService.ts"
      provides: "tmux session switching logic"
      exports: ["jumpToSession"]
    - path: "src/app.tsx"
      provides: "Enter key handler wired to jumpService"
      contains: "key.return"
  key_links:
    - from: "src/app.tsx"
      to: "src/services/jumpService.ts"
      via: "import and call on Enter"
      pattern: "import.*jumpToSession"
    - from: "src/services/jumpService.ts"
      to: "tmux switch-client"
      via: "execAsync shell command"
      pattern: "tmux switch-client"
---

<objective>
Create jump service for tmux session switching and wire Enter key to jump to the selected session.

Purpose: Enable users to quickly switch to a Claude session's terminal, completing NAV-02 requirement and preparing for Phase 6 (Terminal Integration).
Output: Working Enter key that switches to selected tmux session, with graceful handling of non-tmux and missing sessions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-navigation/05-RESEARCH.md
@.planning/phases/05-navigation/05-01-SUMMARY.md

# Key existing files
@src/app.tsx
@src/services/platform.ts
@src/services/tmuxService.ts
@src/stores/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create jumpService.ts</name>
  <files>src/services/jumpService.ts</files>
  <action>
Create a new service file `src/services/jumpService.ts` for handling session jumping.

The service should:

1. Export a `JumpResult` interface:
```typescript
export interface JumpResult {
  success: boolean;
  message: string;
}
```

2. Export an async function `jumpToSession(session: Session): Promise<JumpResult>`:

Logic:
- If `!session.inTmux || !session.tmuxTarget`: Return error "Cannot jump to non-tmux session"
- Check if HUD is running inside tmux: `!!process.env.TMUX`
- If inside tmux:
  - Parse session name from tmuxTarget (format: "session:window.pane")
  - Use `tmux switch-client -t "${sessionName}"` to switch client to target session
  - Use `tmux select-window -t "${session.tmuxTarget}"` to select specific window/pane
  - Return success message
- If not inside tmux:
  - Use `tmux attach-session -t "${sessionName}"` (this will take over terminal)
  - Return success message (though HUD will be replaced)
- Wrap in try/catch, return error on failure

Import dependencies:
```typescript
import { execAsync } from './platform.js';
import type { Session } from '../stores/types.js';
```

Full implementation:
```typescript
import { execAsync } from './platform.js';
import type { Session } from '../stores/types.js';

export interface JumpResult {
  success: boolean;
  message: string;
}

/**
 * Jump to a Claude session's terminal.
 *
 * For tmux sessions:
 * - If HUD is inside tmux: use switch-client to switch to session's pane
 * - If HUD is not in tmux: attach-session (takes over current terminal)
 *
 * For non-tmux sessions:
 * - Return error (can't programmatically focus arbitrary terminals)
 */
export async function jumpToSession(session: Session): Promise<JumpResult> {
  // Non-tmux sessions: can't jump programmatically
  if (!session.inTmux || !session.tmuxTarget) {
    return {
      success: false,
      message: `Cannot jump: ${session.projectName} is not in tmux`,
    };
  }

  try {
    const isHudInTmux = !!process.env.TMUX;

    // Parse session name from target (format: "session:window.pane")
    const colonIdx = session.tmuxTarget.indexOf(':');
    const sessionName = colonIdx > 0
      ? session.tmuxTarget.substring(0, colonIdx)
      : session.tmuxTarget;

    if (isHudInTmux) {
      // switch-client changes current tmux client to target session
      await execAsync(`tmux switch-client -t "${sessionName}"`);
      // Then select the specific window.pane
      await execAsync(`tmux select-window -t "${session.tmuxTarget}"`);

      return { success: true, message: `Switched to ${session.projectName}` };
    } else {
      // Not in tmux: attach-session will take over this terminal
      // This effectively exits the HUD
      await execAsync(`tmux attach-session -t "${sessionName}"`);
      return { success: true, message: `Attached to ${session.projectName}` };
    }
  } catch (error) {
    const msg = error instanceof Error ? error.message : String(error);
    // Common case: session no longer exists
    if (msg.includes('no session') || msg.includes('can\'t find')) {
      return {
        success: false,
        message: `Session no longer exists: ${session.projectName}`,
      };
    }
    return {
      success: false,
      message: `Jump failed: ${msg}`,
    };
  }
}
```
  </action>
  <verify>
TypeScript compiles: `npm run build`
  </verify>
  <done>
jumpService.ts exists with jumpToSession function.
Function handles tmux vs non-tmux HUD scenarios.
Function handles non-tmux sessions gracefully.
Error handling for missing sessions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Enter key to jumpService</name>
  <files>src/app.tsx</files>
  <action>
Update app.tsx to handle Enter key for session jumping:

1. Add import at top:
```typescript
import { jumpToSession } from './services/jumpService.js';
```

2. In the useInput callback, after the number hotkey handler and before the q handler, add Enter key handling:

```typescript
// Enter to jump to selected session
if (key.return) {
  const state = useAppStore.getState();
  const session = state.sessions[state.selectedIndex];
  if (session) {
    jumpToSession(session).then((result) => {
      if (!result.success) {
        state.setError(result.message);
        // Auto-clear error after 3 seconds
        setTimeout(() => {
          useAppStore.getState().setError(null);
        }, 3000);
      }
    });
  }
  return;
}
```

3. Also add 'x' key handler to dismiss error (the error overlay already mentions "x to dismiss"):

After the Enter handler:
```typescript
// x to dismiss error
if (input === 'x') {
  useAppStore.getState().setError(null);
  return;
}
```

Note: The Enter handler should be placed AFTER navigation handlers but BEFORE q/? handlers to maintain logical grouping.
  </action>
  <verify>
TypeScript compiles: `npm run build`
Run HUD manually in tmux: `npm run dev`
- Navigate to a tmux session
- Press Enter - should switch to that tmux window
- Navigate to a non-tmux session (if any)
- Press Enter - should show error message
- Press x - should dismiss error
  </verify>
  <done>
Enter key triggers jumpToSession for selected session.
Non-tmux sessions display error message.
x key dismisses error message.
Error auto-clears after 3 seconds.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete keyboard navigation system:
- j/k and arrow keys move selection up/down
- Number keys 1-9 quick-jump to session
- Selected row has inverse colors (visually distinct)
- Enter key jumps to tmux session
- Non-tmux sessions show helpful error
- x key dismisses errors
  </what-built>
  <how-to-verify>
1. Start the HUD inside a tmux session: `npm run dev`
2. Verify at least one Claude session is detected and displayed
3. Test navigation:
   - Press j - selection should move down
   - Press k - selection should move up
   - Press down arrow - should move down
   - Press up arrow - should move up
   - Press 1 - should jump to first session
   - Press 3 (if 3 sessions exist) - should jump to third session
4. Verify selection visual:
   - Selected row should have inverted colors (high contrast)
   - Non-selected rows should look normal
5. Test session jumping:
   - Select a tmux session (has [T] indicator)
   - Press Enter - should switch to that tmux window
   - Return to HUD (tmux navigation)
   - Verify HUD is still running
6. Test error handling:
   - If you have a non-tmux session, select it and press Enter
   - Should see error message
   - Press x - error should dismiss
7. Test existing functionality still works:
   - Press ? - help overlay should appear
   - Press any key - help should dismiss
   - Press q - quit confirmation should appear
   - Press n or wait - should dismiss
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes with no TypeScript errors
2. `npm run dev` launches HUD successfully
3. Enter key jumps to selected tmux session
4. HUD keeps running after jump (when run inside tmux)
5. Non-tmux sessions show appropriate error message
6. x key dismisses error message
7. All navigation from Plan 01 still works
</verification>

<success_criteria>
- NAV-02 satisfied: User can select a session with Enter key
- Enter on tmux session switches focus to that tmux pane
- HUD continues running after jumping (does not exit when inside tmux)
- Non-tmux sessions show helpful error message
- Error handling for missing/stale sessions
- TypeScript compiles, no runtime errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation/05-02-SUMMARY.md`
</output>
