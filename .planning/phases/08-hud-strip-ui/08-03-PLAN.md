---
phase: 08-hud-strip-ui
plan: 03
type: execute
wave: 2
depends_on: ["08-02"]
files_modified:
  - src/app.tsx
  - src/components/HudStrip.tsx
autonomous: false

must_haves:
  truths:
    - "HUD displays as compact 1-2 line strip instead of full-screen list"
    - "Help text appears on second line when ? is pressed"
    - "Error messages appear on second line when present"
    - "Tab navigation with left/right arrows scrolls the tab bar"
    - "All existing keyboard shortcuts (j/k, 1-9, Enter, q, b) continue to work"
  artifacts:
    - path: "src/components/HudStrip.tsx"
      provides: "Top-level HUD container with TabStrip and adaptive second line"
      exports: ["HudStrip"]
    - path: "src/app.tsx"
      provides: "Updated app layout using HudStrip"
      contains: "HudStrip"
  key_links:
    - from: "src/components/HudStrip.tsx"
      to: "src/components/TabStrip.tsx"
      via: "TabStrip import and render"
      pattern: "import.*TabStrip.*from"
    - from: "src/app.tsx"
      to: "src/components/HudStrip.tsx"
      via: "HudStrip import and render"
      pattern: "import.*HudStrip.*from"
---

<objective>
Create the HudStrip wrapper component and integrate it into app.tsx, replacing the Header/SessionList/Footer with a compact 1-2 line display. Update navigation keys to support horizontal tab scrolling.

Purpose: Complete the HUD strip UI transformation and verify everything works end-to-end.
Output: Working HUD strip UI with adaptive line count and all keyboard navigation functional.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-hud-strip-ui/08-CONTEXT.md
@.planning/phases/08-hud-strip-ui/08-RESEARCH.md
@.planning/phases/08-hud-strip-ui/08-01-SUMMARY.md
@.planning/phases/08-hud-strip-ui/08-02-SUMMARY.md

@src/app.tsx
@src/components/TabStrip.tsx
@src/components/Header.tsx
@src/components/Footer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HudStrip wrapper component</name>
  <files>src/components/HudStrip.tsx</files>
  <action>
Create HudStrip component that wraps TabStrip and handles the adaptive 1-2 line layout.

Implementation:

1. **Props interface:**
```typescript
interface HudStripProps {
  showHelp: boolean;
  error: string | null;
}
```

2. **Structure (from CONTEXT.md):**
   - Line 1: Always TabStrip
   - Line 2: Help text OR error message OR nothing (1-line mode)
   - Background color to distinguish from main pane (use subtle gray like #1a1a1a or Ink's equivalent)

3. **Help text (compact version of Footer.tsx content):**
```
<-/->: scroll | Enter: jump | j/k: nav | 1-9: quick | q: quit | ?: help
```

4. **Error display:**
   - Show error text in red
   - Include "(x to dismiss)" hint
   - Error takes precedence if both showHelp and error are truthy? No - per CONTEXT.md showHelp OR error, not both

5. **Render structure:**
```tsx
<Box flexDirection="column" backgroundColor="#333333">
  <TabStrip />
  {showHelp && (
    <Text dimColor>
      {figures.arrowLeft}/{figures.arrowRight}: scroll | Enter: jump | j/k: nav | 1-9: quick | q: quit | ?: help
    </Text>
  )}
  {error && !showHelp && (
    <Box>
      <Text color="red">{error}</Text>
      <Text dimColor> (x to dismiss)</Text>
    </Box>
  )}
</Box>
```

6. **Import figures for arrow symbols**
  </action>
  <verify>
File exists at src/components/HudStrip.tsx
TypeScript compiles: `npm run build`
Component exports HudStrip
  </verify>
  <done>
HudStrip component wraps TabStrip with adaptive second line for help/error display.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate HudStrip into app.tsx</name>
  <files>src/app.tsx</files>
  <action>
Update app.tsx to use HudStrip instead of Header/SessionList/Footer.

Changes:

1. **Remove old imports:**
   - Remove: import { Header } from './components/Header.js'
   - Remove: import { Footer } from './components/Footer.js'
   - Remove: import { SessionList } from './components/SessionList.js'

2. **Add new import:**
   - Add: import { HudStrip } from './components/HudStrip.js'

3. **Update navigation keys:**
   Current j/k handles up/down. For horizontal strip, add left/right arrow support:
   - Keep j/k working (for familiarity)
   - Add left arrow: decrement selectedIndex (same as k)
   - Add right arrow: increment selectedIndex (same as j)

   In useInput handler, add:
   ```typescript
   if (key.leftArrow) {
     useAppStore.getState().setSelectedIndex(
       Math.max(selectedIndex - 1, 0)
     );
     return;
   }
   if (key.rightArrow) {
     useAppStore.getState().setSelectedIndex(
       Math.min(selectedIndex + 1, sessions.length - 1)
     );
     return;
   }
   ```

4. **Update render return:**
   Replace the entire main layout with just HudStrip:
   ```tsx
   return (
     <Box flexDirection="column">
       <HudStrip showHelp={showHelp} error={error} />

       {/* Keep overlays (exit confirmation, quit prompt, help overlay) for now */}
       {/* They use position="absolute" so they'll overlay the strip */}

       {isConfirmingExit && (...)}
       {quitMode === 'confirming' && (...)}
       {showHelp && (...)}  // NOTE: This overlay may need adjustment
     </Box>
   );
   ```

5. **Overlay positioning:**
   - The existing overlays use position="absolute" with marginTop
   - With the compact strip (1-2 lines), overlays need adjustment
   - Help overlay should NOT be shown as overlay since HudStrip handles inline help
   - Remove the showHelp overlay block (it's now inline in HudStrip)
   - Keep exit confirmation and quit prompt overlays

6. **Remove padding:**
   - Remove `padding={1}` from outer Box (HUD strip goes edge-to-edge)

7. **Remove flexGrow from middle section:**
   - The HUD strip is just 1-2 lines, no need for flex grow
  </action>
  <verify>
TypeScript compiles: `npm run build`
App renders without errors: `npm start` (visual check)
Left/right arrows navigate tabs
  </verify>
  <done>
app.tsx uses HudStrip, supports left/right arrow navigation, and overlays are positioned correctly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete HUD strip UI transformation:
- Horizontal tab strip showing all sessions
- Blocked sessions pinned and visually distinct (red background)
- Selected session highlighted (inverse colors)
- Scroll arrows when tabs overflow
- Adaptive 1-2 line display (help text on second line with ?)
- Left/right arrow navigation in addition to j/k
  </what-built>
  <how-to-verify>
1. Start the HUD: `npm run build && npm start`
2. Verify the display is 1-2 lines (not full screen list)
3. If you have multiple Claude sessions:
   - Verify all sessions show as horizontal tabs
   - Press left/right arrows to navigate between sessions
   - Verify selected session has inverse colors
   - If any session is blocked, verify it has red background and is pinned left
4. Press ? to toggle help - verify help text appears on second line
5. Resize terminal - verify tabs adjust and scroll arrows appear/disappear
6. Press j/k - verify they still work for navigation
7. Press number keys 1-9 - verify quick select works
8. Press Enter on selected session - verify jump still works
9. Press q - verify quit prompt appears
  </how-to-verify>
  <resume-signal>Type "approved" if HUD strip works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
```bash
# Build succeeds
npm run build

# New component exists
ls src/components/HudStrip.tsx
grep -q "export function HudStrip" src/components/HudStrip.tsx

# App uses HudStrip
grep -q "HudStrip" src/app.tsx
grep -q "import.*HudStrip" src/app.tsx

# Old components removed from app imports
! grep -q "import.*Header.*from" src/app.tsx
! grep -q "import.*Footer.*from" src/app.tsx
! grep -q "import.*SessionList.*from" src/app.tsx

# Left/right arrow handling added
grep -q "leftArrow\|rightArrow" src/app.tsx
```
</verification>

<success_criteria>
- HudStrip component created and wraps TabStrip
- app.tsx uses HudStrip instead of Header/SessionList/Footer
- Left/right arrow keys navigate tabs
- Help text appears inline on second line (not as overlay)
- Error messages display on second line
- All existing keyboard shortcuts work
- Human verification confirms visual appearance is correct
</success_criteria>

<output>
After completion, create `.planning/phases/08-hud-strip-ui/08-03-SUMMARY.md`
</output>
